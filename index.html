<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>五行能量洞察</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4CAF50; /* Green for Wood */
            --secondary-color: #FF9800; /* Orange for Fire */
            --text-color: #333;
            --background-start: #e0f2f7; /* Light Blue-Grey */
            --background-end: #f5f5dc; /* Light Beige */
            --card-background: #ffffff;
            --border-color: #ddd;
            --button-hover-color: #45a049;

            /* Element-specific colors for Chart.js and text */
            --wood-color: #2e8b57; /* Sea Green */
            --fire-color: #e44d26; /* Cinnabar */
            --earth-color: #a0522d; /* Sienna */
            --metal-color: #a9a9a9; /* Dark Gray */
            --water-color: #2b6cb0; /* Strong Blue */

            --cta-dark-orange: #E67817; /* For "Explore Your Element Collection" */
        }

        body {
            font-family: 'Open Sans', 'Microsoft YaHei', 'PingFang SC', sans-serif; /* Added Chinese fonts */
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom right, var(--background-start), var(--background-end));
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 90%;
            margin: 20px auto;
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
            opacity: 0; /* For fade-in effect */
            transform: translateY(20px); /* For slight slide-up effect */
            animation: fadeInSlideUp 0.8s ease-out forwards;
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1, h2 {
            font-family: 'Montserrat', 'Microsoft YaHei', 'PingFang SC', sans-serif; /* Added Chinese fonts */
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
        }

        h2 {
            color: var(--secondary-color);
            margin-top: 30px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="date"],
        input[type="time"] {
            width: calc(100% - 22px);
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        button:hover {
            background-color: var(--button-hover-color);
            transform: translateY(-2px);
        }

        #results {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .result-section {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.8s ease-out forwards;
            animation-delay: 0.5s; /* Delay for results section to appear after form */
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .result-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-family: 'Montserrat', 'Microsoft YaHei', 'PingFang SC', sans-serif; /* Added Chinese fonts */
            text-align: center;
        }

        .result-section p {
            margin-bottom: 10px;
        }

        .element-percentages {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .element-percent-item {
            background-color: #f0f0f0;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            min-width: 120px;
            justify-content: center;
        }

        .element-percent-item strong {
            margin-right: 5px;
        }
        /* Specific colors for elements */
        .element-percent-item.wood { border-color: var(--wood-color); color: var(--wood-color); }
        .element-percent-item.fire { border-color: var(--fire-color); color: var(--fire-color); }
        .element-percent-item.earth { border-color: var(--earth-color); color: var(--earth-color); }
        .element-percent-item.metal { border-color: var(--metal-color); color: var(--metal-color); }
        .element-percent-item.water { border-color: var(--water-color); color: var(--water-color); }

        .chart-container {
            position: relative;
            margin: auto;
            width: 80%;
            max-width: 300px;
            margin-bottom: 20px;
        }

        .cta-button {
            display: block;
            width: fit-content;
            margin: 20px auto 10px;
            padding: 15px 30px;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 700;
            text-align: center;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        #exploreCollectionBtn {
            background-color: var(--cta-dark-orange);
        }
        #exploreCollectionBtn:hover {
            background-color: #cc6711;
            transform: translateY(-2px);
        }

        .social-share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .social-share-buttons a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 15px;
            border-radius: 5px;
            text-decoration: none;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
            transition: opacity 0.3s ease, transform 0.2s ease;
            min-width: 100px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            border: none;
            cursor: pointer;
        }

        .social-share-buttons a:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        .share-facebook { background-color: #3b5998; }
        .share-twitter { background-color: #1da1f2; }
        .share-whatsapp { background-color: #25d366; }

        .footer {
            text-align: center;
            font-size: 0.8em;
            color: #777;
            margin-top: 40px;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            width: 100%;
            box-sizing: border-box;
        }

        .loading-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: 'Montserrat', 'Microsoft YaHei', 'PingFang SC', sans-serif; /* Added Chinese fonts */
            color: var(--primary-color);
            font-size: 1.2em;
            font-weight: 600;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
                margin: 10px auto;
            }

            input[type="text"],
            input[type="date"],
            input[type="time"] {
                width: 100%;
            }

            button, .cta-button {
                font-size: 16px;
                padding: 12px;
            }
            .element-percentages {
                flex-direction: column;
                align-items: stretch;
            }
            .social-share-buttons a {
                width: 45%; /* Two buttons per row on small screens */
                margin-bottom: 10px;
            }
            .social-share-buttons {
                justify-content: space-around; /* Distribute remaining 3 buttons */
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        正在生成您的洞察报告...
    </div>

    <div class="container">
        <h1>探索您的五行能量</h1>
        <p style="text-align: center; margin-bottom: 30px;">揭示源自古老哲学的个人洞察。只需输入您的出生信息，即可了解您独特的五行构成。</p>

        <form id="elementalForm">
            <div class="form-group">
                <label for="userName">您的姓名:</label>
                <input type="text" id="userName" name="userName" required>
            </div>
            <div class="form-group">
                <label for="birthDate">出生日期:</label>
                <input type="date" id="birthDate" name="birthDate" required>
            </div>
            <div class="form-group">
                <label for="birthTime">出生时间:</label>
                <input type="time" id="birthTime" name="birthTime" required>
            </div>
            <button type="submit">生成报告</button>
        </form>

        <div id="results">
            <h2><span id="displayedUserName"></span>的五行能量报告</h2>

            <div class="result-section">
                <h3>您的五行构成:</h3>
                <div class="element-percentages" id="elementPercentagesOutput">
                    </div>
                <div class="chart-container">
                    <canvas id="elementalChart"></canvas>
                </div>
            </div>

            <div class="result-section">
                <h3>您的核心能量与影响:</h3>
                <p><strong>主导元素:</strong> <span id="dominantElementOutput"></span></p>
                <p><strong>性格洞察:</strong> <span id="personalityType"></span></p>
                <p><strong>能量风格:</strong> <span id="energyStyle"></span></p>
                <p><strong>五行气场:</strong> <span id="elementalVibe"></span></p>
            </div>

            <div class="result-section">
                <h3>生活习性偏好:</h3>
                <p id="lifestyleAffinity"></p>
            </div>

            <div class="result-section">
                <h3>和谐与平衡建议:</h3>
                <p id="balanceSuggestions"></p>
            </div>

            <a id="exploreCollectionBtn" class="cta-button" href="#" target="_blank">探索您的专属五行系列</a>

            <div class="social-share-buttons">
                <a href="#" class="share-facebook" target="_blank">分享到Facebook</a>
                <a href="#" class="share-twitter" target="_blank">分享到Twitter</a>
                <a href="#" class="share-whatsapp" target="_blank">分享到WhatsApp</a>
            </div>

            </div>
    </div>

    <div class="footer">
        本服务仅供娱乐和个人洞察之用，不作为专业医疗或心理指导的替代。
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let elementalChartInstance = null; // To hold Chart.js instance

            // Function to calculate elemental proportions based on birth data
            function calculateElementalProportions(birthDate, birthTime) {
                const monthVal = birthDate.getMonth(); // 0-11
                const dayVal = birthDate.getDate();   // 1-31
                const hourVal = birthTime.getHours(); // 0-23
                const minuteVal = birthTime.getMinutes(); // 0-59
                const year = birthDate.getFullYear();

                let elementScores = { "木": 0, "火": 0, "土": 0, "金": 0, "水": 0 }; // Translated elements
                const elements = ["木", "火", "土", "金", "水"]; // Mapped index 0-4

                // Assign points to elements using modulo of various birth data components
                // This provides a more distributed and varied percentage breakdown
                elementScores[elements[monthVal % 5]] += 2; // Month has slightly higher weight
                elementScores[elements[dayVal % 5]] += 1.5;
                elementScores[elements[hourVal % 5]] += 1.2;
                elementScores[elements[minuteVal % 5]] += 1;

                // Add a point from the sum of year digits for more variation
                const yearSumDigits = String(year).split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                elementScores[elements[yearSumDigits % 5]] += 1.3;

                // Add a point from the last digit of the year for another layer of variation
                elementScores[elements[(year % 10) % 5]] += 0.8;

                // Calculate total score and percentages
                let totalScore = Object.values(elementScores).reduce((sum, current) => sum + current, 0);

                let elementalPercentages = {};
                if (totalScore > 0) {
                    let currentSum = 0;
                    for (const el of elements) { // Iterate in fixed order to ensure consistency
                        const percentage = parseFloat((elementScores[el] / totalScore * 100).toFixed(1));
                        elementalPercentages[el] = percentage;
                        currentSum += percentage;
                    }
                    // Adjust for potential rounding errors to ensure sum is 100%
                    const diff = 100 - currentSum;
                    if (Math.abs(diff) > 0.01) { // Only adjust if difference is significant
                        const largestElem = Object.keys(elementalPercentages).reduce((a, b) => elementalPercentages[a] > elementalPercentages[b] ? a : b);
                        elementalPercentages[largestElem] = parseFloat((elementalPercentages[largestElem] + diff).toFixed(1));
                    }
                } else {
                    elements.forEach(el => elementalPercentages[el] = 20.0); // Default to equal if no scores
                }

                return elementalPercentages;
            }

            // --- Detailed Descriptions for Dynamic Report Generation ---
            // These descriptions are designed to be positive and combine smoothly.
            const descriptions = {
                "木": {
                    core_personality: "您以其**成长导向**、**开拓精神**、**富有同情心**和**果断**的性格而闻名。",
                    core_energy: "您的能量是**动态**且**开阔**的，常常驱使您开启新事业并克服障碍。",
                    core_vibe: "您散发着**清新**、**活力**和**创新**的气场。",
                    lifestyle: "您在新起点中茁壮成长，并从大自然、艺术表达和协作环境中获得能量。参与户外活动、创意项目和社区活动能让您感觉最佳。",
                    balance: "为保持和谐，请拥抱灵活性和耐心。尽管您雄心勃勃，但要学会顺应变化，避免过度强求。参与园艺、亲近自然或练习正念运动等平静活动。平衡您的驱动力与充足的休息和温和的自我关怀，以防耗尽精力。",
                    secondary_influence_personality: "这为您的核心特质增添了一层基础韧性和开拓精神。",
                    secondary_influence_energy: "您的能量还带有一种持续更新和追求进步的微妙电流。",
                    secondary_influence_vibe: "您散发着坚韧和清新的品质，总是展望成长和新的可能性。"
                },
                "火": {
                    core_personality: "您以其**热情**、**积极**、**魅力非凡**和**鼓舞人心**的性格而闻名。",
                    core_energy: "您的能量是**强烈**且**变革性**的，带来温暖和兴奋，并激发他人的行动。",
                    core_vibe: "您展现出**光芒四射**、**充满活力**和**迷人**的气场。",
                    lifestyle: "您喜欢充满活力的社交聚会、表演艺术和冒险旅行。通过引人入胜的爱好表达自我，并享受成为刺激体验中心的乐趣。",
                    balance: "为保持和谐，培养内心的平静和适度。您炽热的本性可能导致过度刺激；通过正念、冥想或温和的运动来降温。避免过度刺激物，确保有足够的时间进行安静的反思，以防止冲动并保持您的内在火花。",
                    secondary_influence_personality: "这为您的性格注入了额外的热情火花和引人注目的鼓舞人心的渴望。",
                    secondary_influence_energy: "您的能量被一种温暖、富有感染力的热情进一步放大，毫不费力地点燃他人。",
                    secondary_influence_vibe: "您还散发着无可否认的温暖和灵感之光，吸引人们走向您。"
                },
                "土": {
                    core_personality: "您以其**稳定**、**务实**、**滋养**和**实用**的性格而闻名。",
                    core_energy: "您的能量是**稳健**且**和谐**的，促进稳定、安全和持续的支持。",
                    core_vibe: "您散发着**舒适**、**可靠**和**坚实**的气场。",
                    lifestyle: "您从创造一个滋养的家庭环境、参与实用技能和社区服务中找到乐趣。舒适的日常习惯和健康的饮食给您带来深深的满足感和安全感。",
                    balance: "为保持和谐，鼓励适应性和开放性。尽管稳定性是您的优势，但要对新体验和走出舒适区保持开放态度。通过活在当下、专注于您可以控制的事物，并参与园艺或亲近自然等接地气的活动来管理忧虑和过度思考。",
                    secondary_influence_personality: "这为您的核心特质提供了稳定、滋养的基础，使您格外可靠和支持。",
                    secondary_influence_energy: "您的能量增加了额外的稳定层，以及一种支持性、和谐的存在，让其他人感到安心。",
                    secondary_influence_vibe: "您还散发着一种深具安慰和值得信赖的气场，让其他人感到在您身边很安全。"
                },
                "金": {
                    core_personality: "您以其**有条理**、**纪律严明**、**精确**和**洞察力强**的性格而闻名。",
                    core_energy: "您的能量是**精炼**且**结构化**的，强调清晰和秩序，并带来高效的结果。",
                    core_vibe: "您展现出**清晰**、**明了**和**专注**的气场。",
                    lifestyle: "您欣赏极简之美、逻辑思维以及需要精确的活动。极简主义生活、智力追求和有条理的日常对您非常有吸引力。您在干净、有序的环境中茁壮成长。",
                    balance: "为保持和谐，培养情感表达和自发性。尽管结构很重要，但要为直觉和感受留出空间。真诚地与他人联系并释放僵化。将改变视为成长中自然的一部分，放下对绝对控制的需要。",
                    secondary_influence_personality: "这为您的性格赋予了清晰的洞察力和一丝精致的优雅，增强了您的严谨性。",
                    secondary_influence_energy: "您的能量还带有精确、以结果为导向的焦点以及对纯粹和卓越的渴望。",
                    secondary_influence_vibe: "您展现出清晰、敏锐且通常是精致的存在，带着一种高贵的决心感。"
                },
                "水": {
                    core_personality: "您以其**直觉敏锐**、**适应性强**、**善于反思**和**富有同理心**的性格而闻名。",
                    core_energy: "您的能量是**流动**且**深邃**的，代表智慧和内省，让您优雅地适应。",
                    core_vibe: "您散发着**平静**、**神秘**和**深刻**的气场。",
                    lifestyle: "您在允许沉思、情感深度以及与内心世界连接的环境中茁壮成长。独自反思、创意写作、精神实践以及瑜伽或游泳等流畅的运动对您非常有益。",
                    balance: "为保持和谐，建立清晰的界限和自我主张。尽管富有同情心，但要确保您不会过多地吸收他人的情绪。参与能建立自信和帮助您表达需求的活动。避免孤立和停滞，通过与支持性社区联系并将您的智慧向外传递。",
                    secondary_influence_personality: "这为您的互动增添了一层深刻的直觉和深厚的同理心，使您非常善解人意。",
                    secondary_influence_energy: "您的能量拥有微妙、适应性强的流动和深刻的洞察力，让您能够洞悉表面之下。",
                    secondary_influence_vibe: "您还散发着一种宁静、深思熟虑和深刻理解的气场，吸引人们建立有意义的连接。"
                }
            };

            // Function to draw the Chart.js pie chart
            function drawChart(percentages) {
                const ctx = document.getElementById('elementalChart').getContext('2d');
                // Use Chinese labels for the chart
                const labels = Object.keys(percentages); // e.g., ["木", "火", "土", "金", "水"]
                const data = Object.values(percentages).map(Number); // Convert to numbers for Chart.js

                const backgroundColors = labels.map(label => {
                    switch (label) {
                        case '木': return 'rgb(46, 139, 87)'; // Sea Green
                        case '火': return 'rgb(228, 77, 38)';  // Cinnabar
                        case '土': return 'rgb(160, 82, 45)'; // Sienna
                        case '金': return 'rgb(169, 169, 169)';// Dark Gray
                        case '水': return 'rgb(43, 108, 176)'; // Strong Blue
                        default: return '#cccccc';
                    }
                });

                if (elementalChartInstance) {
                    elementalChartInstance.destroy(); // Destroy existing chart if it exists
                }

                elementalChartInstance = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors,
                            hoverOffset: 10,
                            borderWidth: 1,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        family: 'Open Sans, Microsoft YaHei, PingFang SC', // Ensure Chinese font for legend
                                        size: 14
                                    },
                                    color: '#333'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed + '%';
                                        }
                                        return label;
                                    }
                                },
                                titleFont: {
                                    family: 'Open Sans, Microsoft YaHei, PingFang SC' // Ensure Chinese font for tooltip title
                                },
                                bodyFont: {
                                    family: 'Open Sans, Microsoft YaHei, PingFang SC' // Ensure Chinese font for tooltip body
                                }
                            }
                        }
                    }
                });
            }

            document.getElementById('elementalForm').addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent default form submission

                const userNameInput = document.getElementById('userName');
                const birthDateInput = document.getElementById('birthDate');
                const birthTimeInput = document.getElementById('birthTime');

                // Basic validation (should be caught by 'required' in HTML, but good to double check)
                if (!userNameInput || !birthDateInput || !birthTimeInput) {
                    alert('错误：缺少必需的表单元素。请确保您的页面已正确加载。');
                    return;
                }

                const userName = userNameInput.value;
                const birthDateStr = birthDateInput.value;
                const birthTimeStr = birthTimeInput.value;

                if (!userName || !birthDateStr || !birthTimeStr) {
                    alert('请填写所有字段以生成您的五行能量洞察报告。');
                    return;
                }

                const birthDate = new Date(birthDateStr);
                const birthTime = new Date(`2000-01-01T${birthTimeStr}`); // Dummy date for time extraction

                if (isNaN(birthDate.getTime()) || isNaN(birthTime.getTime())) {
                    alert('请输入有效的出生日期和时间。');
                    return;
                }

                // Show loading overlay
                document.getElementById('loadingOverlay').style.display = 'flex';

                // Simulate loading for better UX
                setTimeout(() => {
                    const elementalPercentages = calculateElementalProportions(birthDate, birthTime);

                    // Determine the dominant and secondary elements by percentage
                    let sortedElements = Object.keys(elementalPercentages).sort((a, b) => parseFloat(elementalPercentages[b]) - parseFloat(elementalPercentages[a]));
                    const dominantElement = sortedElements[0];
                    let secondaryElement = sortedElements.length > 1 ? sortedElements[1] : dominantElement;
                    if (dominantElement === secondaryElement && sortedElements.length > 2) {
                        secondaryElement = sortedElements[2]; // Get third if dominant and secondary are the same
                    } else if (dominantElement === secondaryElement && sortedElements.length === 1) {
                        secondaryElement = dominantElement; // If only one element (unlikely but safe)
                    }

                    // Get descriptions for dominant and secondary elements
                    const dominantDesc = descriptions[dominantElement];
                    const secondaryDesc = descriptions[secondaryElement];

                    // --- Display Results ---
                    document.getElementById('displayedUserName').textContent = userName;
                    document.getElementById('dominantElementOutput').textContent = `${dominantElement} (${elementalPercentages[dominantElement]}%)`;

                    // Display all elemental percentages
                    const percentagesOutputDiv = document.getElementById('elementPercentagesOutput');
                    percentagesOutputDiv.innerHTML = ''; // Clear previous results
                    const orderedElements = ["木", "火", "土", "金", "水"]; // Consistent display order
                    orderedElements.forEach(el => {
                        const percent = elementalPercentages[el] || "0.0";
                        const div = document.createElement('div');
                        // Ensure CSS class uses lowercase English for styling
                        const classForCss = { "木": "wood", "火": "fire", "土": "earth", "金": "metal", "水": "water" };
                        div.className = `element-percent-item ${classForCss[el]}`;
                        div.innerHTML = `<strong>${el}:</strong> ${percent}%`;
                        percentagesOutputDiv.appendChild(div);
                    });

                    // Draw the Chart.js pie chart
                    drawChart(elementalPercentages);


                    // Combine descriptions for Personality, Energy, Vibe
                    // Ensure secondary influence is only added if there's a distinct secondary element
                    document.getElementById('personalityType').textContent =
                        `${dominantDesc.core_personality} ${secondaryElement !== dominantElement ? secondaryDesc.secondary_influence_personality : ''}`;

                    document.getElementById('energyStyle').textContent =
                        `${dominantDesc.core_energy} ${secondaryElement !== dominantElement ? secondaryDesc.secondary_influence_energy : ''}`;

                    document.getElementById('elementalVibe').textContent =
                        `${dominantDesc.core_vibe} ${secondaryElement !== dominantElement ? secondaryDesc.secondary_influence_vibe : ''}`;

                    document.getElementById('lifestyleAffinity').textContent = dominantDesc.lifestyle;
                    document.getElementById('balanceSuggestions').textContent = dominantDesc.balance;

                    // Update CTA links based on Dominant Element with ABSOLUTE URLs
                    const collectionMap = {
                        "木": "https://rypp4d-qy.myshopify.com/collections/wood-collection",
                        "火": "https://rypp4d-qy.myshopify.com/collections/fire-collection",
                        "土": "https://rypp4d-qy.myshopify.com/collections/earth-collection",
                        "金": "https://rypp4d-qy.myshopify.com/collections/metal-collection",
                        "水": "https://rypp4d-qy.myshopify.com/collections/water-collection"
                    };
                    // Use English element names for the URL mapping if that's what the Shopline collection URLs use
                    const dominantElementEnglish = { "木": "wood", "火": "fire", "土": "earth", "金": "metal", "水": "water" }[dominantElement];
                    document.getElementById('exploreCollectionBtn').href = collectionMap[dominantElement] || 'https://fiveflowstudio.com/collections/all'; // Fallback to 'all' if element not found

                    // --- Social Sharing ---
                    const currentPageURL = encodeURIComponent(window.location.href);
                    // Social sharing texts remain in English or are generic, as platforms handle translation
                    document.querySelector('.share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${currentPageURL}`;
                    document.querySelector('.share-twitter').href = `https://twitter.com/intent/tweet?url=${currentPageURL}&text=探索您的五行能量洞察！`; // Added Chinese text
                    document.querySelector('.share-whatsapp').href = `https://api.whatsapp.com/send?text=探索您的五行能量洞察！ ${currentPageURL}`; // Added Chinese text


                    // Hide loading overlay and show results
                    document.getElementById('loadingOverlay').style.display = 'none';
                    document.getElementById('results').style.display = 'block';

                    // Scroll to results for better UX on mobile
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

                }, 1000); // Simulate 1 second loading time
            });
        });
    </script>
</body>
</html>
