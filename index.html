<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Five Element Energy Insight</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4CAF50; /* Green for Wood */
            --secondary-color: #FF9800; /* Orange for Fire */
            --text-color: #333;
            --background-start: #e0f2f7; /* Light Blue-Grey */
            --background-end: #f5f5dc; /* Light Beige */
            --card-background: #ffffff;
            --border-color: #ddd;
            --button-hover-color: #45a049;

            /* Element-specific colors for Chart.js and text */
            --wood-color: #2e8b57; /* Sea Green */
            --fire-color: #e44d26; /* Cinnabar */
            --earth-color: #a0522d; /* Sienna */
            --metal-color: #a9a9a9; /* Dark Gray */
            --water-color: #2b6cb0; /* Strong Blue */

            --cta-dark-blue: #1A73E8; /* For "Get Your Full Report" */
            --cta-dark-orange: #E67817; /* For "Explore Your Element Collection" */
        }

        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom right, var(--background-start), var(--background-end));
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 90%;
            margin: 20px auto;
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
            opacity: 0; /* For fade-in effect */
            transform: translateY(20px); /* For slight slide-up effect */
            animation: fadeInSlideUp 0.8s ease-out forwards;
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1, h2 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
        }

        h2 {
            color: var(--secondary-color);
            margin-top: 30px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="date"],
        input[type="time"] {
            width: calc(100% - 22px);
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        button:hover {
            background-color: var(--button-hover-color);
            transform: translateY(-2px);
        }

        #results {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .result-section {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.8s ease-out forwards;
            animation-delay: 0.5s; /* Delay for results section to appear after form */
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .result-section h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-family: 'Montserrat', sans-serif;
            text-align: center;
        }

        .result-section p {
            margin-bottom: 10px;
        }

        .element-percentages {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .element-percent-item {
            background-color: #f0f0f0;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            min-width: 120px;
            justify-content: center;
        }

        .element-percent-item strong {
            margin-right: 5px;
        }
        /* Specific colors for elements */
        .element-percent-item.wood { border-color: var(--wood-color); color: var(--wood-color); }
        .element-percent-item.fire { border-color: var(--fire-color); color: var(--fire-color); }
        .element-percent-item.earth { border-color: var(--earth-color); color: var(--earth-color); }
        .element-percent-item.metal { border-color: var(--metal-color); color: var(--metal-color); }
        .element-percent-item.water { border-color: var(--water-color); color: var(--water-color); }

        .chart-container {
            position: relative;
            margin: auto;
            width: 80%;
            max-width: 300px;
            margin-bottom: 20px;
        }

        .cta-button {
            display: block;
            width: fit-content;
            margin: 20px auto 10px;
            padding: 15px 30px;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 700;
            text-align: center;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        #exploreCollectionBtn {
            background-color: var(--cta-dark-orange);
        }
        #exploreCollectionBtn:hover {
            background-color: #cc6711;
            transform: translateY(-2px);
        }

        #getFullReportBtn {
            background-color: var(--cta-dark-blue);
        }
        #getFullReportBtn:hover {
            background-color: #155cb8;
            transform: translateY(-2px);
        }

        .cta-note {
            text-align: center;
            font-size: 0.85em;
            color: #666;
            margin-top: -5px;
            margin-bottom: 20px;
        }

        .social-share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .social-share-buttons a, .social-share-buttons button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 15px;
            border-radius: 5px;
            text-decoration: none;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
            transition: opacity 0.3s ease, transform 0.2s ease;
            min-width: 100px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            border: none;
            cursor: pointer;
        }

        .social-share-buttons a:hover, .social-share-buttons button:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        .share-facebook { background-color: #3b5998; }
        .share-twitter { background-color: #1da1f2; }
        .share-whatsapp { background-color: #25d366; }
        .share-copy { background-color: #6c757d; }

        .footer {
            text-align: center;
            font-size: 0.8em;
            color: #777;
            margin-top: 40px;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            width: 100%;
            box-sizing: border-box;
        }

        .loading-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
            font-size: 1.2em;
            font-weight: 600;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
                margin: 10px auto;
            }

            input[type="text"],
            input[type="date"],
            input[type="time"] {
                width: 100%;
            }

            button, .cta-button {
                font-size: 16px;
                padding: 12px;
            }
            .element-percentages {
                flex-direction: column;
                align-items: stretch;
            }
            .social-share-buttons a, .social-share-buttons button {
                width: 45%; /* Two buttons per row on small screens */
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        Generating your insights...
    </div>

    <div class="container">
        <h1>Discover Your Elemental Energy</h1>
        <p style="text-align: center; margin-bottom: 30px;">Unlock personal insights inspired by ancient philosophy. Simply share your birth details to reveal your unique elemental composition.</p>

        <form id="elementalForm">
            <div class="form-group">
                <label for="userName">Your Name:</label>
                <input type="text" id="userName" name="userName" required>
            </div>
            <div class="form-group">
                <label for="birthDate">Date of Birth:</label>
                <input type="date" id="birthDate" name="birthDate" required>
            </div>
            <div class="form-group">
                <label for="birthTime">Time of Birth:</label>
                <input type="time" id="birthTime" name="birthTime" required>
            </div>
            <button type="submit">Generate Report</button>
        </form>

        <div id="results">
            <h2>Your Elemental Profile for <span id="displayedUserName"></span></h2>

            <div class="result-section">
                <h3>Your Elemental Composition:</h3>
                <div class="element-percentages" id="elementPercentagesOutput">
                    </div>
                <div class="chart-container">
                    <canvas id="elementalChart"></canvas>
                </div>
            </div>

            <div class="result-section">
                <h3>Your Core Energy & Influence:</h3>
                <p><strong>Dominant Element:</strong> <span id="dominantElementOutput"></span></p>
                <p><strong>Personality Insights:</strong> <span id="personalityType"></span></p>
                <p><strong>Energy Style:</strong> <span id="energyStyle"></span></p>
                <p><strong>Elemental Vibe:</strong> <span id="elementalVibe"></span></p>
            </div>

            <div class="result-section">
                <h3>Lifestyle Affinity:</h3>
                <p id="lifestyleAffinity"></p>
            </div>

            <div class="result-section">
                <h3>Harmony & Balance Suggestions:</h3>
                <p id="balanceSuggestions"></p>
            </div>

            <a id="exploreCollectionBtn" class="cta-button" href="#" target="_blank">Explore Your Element Collection</a>

            <div class="social-share-buttons">
                <a href="#" class="share-facebook" target="_blank">Facebook</a>
                <a href="#" class="share-twitter" target="_blank">Twitter</a>
                <a href="#" class="share-whatsapp" target="_blank">WhatsApp</a>
                <button type="button" class="share-copy">Copy Link</button>
            </div>

            <a id="downloadReportBtn" class="cta-button" href="#">Download Your Report</a>

            <a id="getFullReportBtn" class="cta-button" href="https://fiveflowstudio.com/preview/products/essential-elemental-report" target="_blank">Get Your Full Elemental Report</a>
            <p class="cta-note">For deeper insights and a full personalized journey.</p>
        </div>
    </div>

    <div class="footer">
        This service is for entertainment and personal insight only. Not intended to replace professional, medical, or psychological guidance.
    </div>

    <script>
        let elementalChartInstance = null; // To hold Chart.js instance

        // Function to calculate elemental proportions based on birth data
        function calculateElementalProportions(birthDate, birthTime) {
            const monthVal = birthDate.getMonth(); // 0-11
            const dayVal = birthDate.getDate();   // 1-31
            const hourVal = birthTime.getHours(); // 0-23
            const minuteVal = birthTime.getMinutes(); // 0-59
            const year = birthDate.getFullYear();

            let elementScores = { "Wood": 0, "Fire": 0, "Earth": 0, "Metal": 0, "Water": 0 };
            const elements = ["Wood", "Fire", "Earth", "Metal", "Water"]; // Mapped index 0-4

            // Assign points to elements using modulo of various birth data components
            // This provides a more distributed and varied percentage breakdown
            elementScores[elements[monthVal % 5]] += 2; // Month has slightly higher weight
            elementScores[elements[dayVal % 5]] += 1.5;
            elementScores[elements[hourVal % 5]] += 1.2;
            elementScores[elements[minuteVal % 5]] += 1;

            // Add a point from the sum of year digits for more variation
            const yearSumDigits = String(year).split('').reduce((sum, digit) => sum + parseInt(digit), 0);
            elementScores[elements[yearSumDigits % 5]] += 1.3;

            // Add a point from the last digit of the year for another layer of variation
            elementScores[elements[(year % 10) % 5]] += 0.8;

            // Calculate total score and percentages
            let totalScore = Object.values(elementScores).reduce((sum, current) => sum + current, 0);

            let elementalPercentages = {};
            if (totalScore > 0) {
                let currentSum = 0;
                for (const el of elements) { // Iterate in fixed order to ensure consistency
                    const percentage = parseFloat((elementScores[el] / totalScore * 100).toFixed(1));
                    elementalPercentages[el] = percentage;
                    currentSum += percentage;
                }
                // Adjust for potential rounding errors to ensure sum is 100%
                const diff = 100 - currentSum;
                if (Math.abs(diff) > 0.01) { // Only adjust if difference is significant
                    const largestElem = Object.keys(elementalPercentages).reduce((a, b) => elementalPercentages[a] > elementalPercentages[b] ? a : b);
                    elementalPercentages[largestElem] = parseFloat((elementalPercentages[largestElem] + diff).toFixed(1));
                }
            } else {
                elements.forEach(el => elementalPercentages[el] = 20.0); // Default to equal if no scores
            }

            return elementalPercentages;
        }

        // --- Detailed Descriptions for Dynamic Report Generation ---
        // These descriptions are designed to be positive and combine smoothly.
        const descriptions = {
            "Wood": {
                core_personality: "You are known for your **growth-oriented**, **pioneering**, **compassionate**, and **decisive** nature.",
                core_energy: "Your energy is **dynamic** and **expansive**, often driving you to initiate new ventures and overcome obstacles.",
                core_vibe: "You exude a **fresh**, **vibrant**, and **innovative** aura.",
                lifestyle: "You thrive on new beginnings and feel energized by nature, artistic expression, and collaborative environments. Pursue outdoor activities, creative projects, and community involvement to feel your best.",
                balance: "To maintain harmony, embrace flexibility and patience. While ambitious, learn to flow with changes and avoid pushing too hard. Engage in calming activities like gardening, spending time in nature, or practicing mindful movement. Balance your drive with adequate rest and gentle self-care to prevent burnout.",
                secondary_influence_personality: "This adds a layer of foundational resilience and a pioneering spirit to your core traits.",
                secondary_influence_energy: "Your energy also carries a subtle current of constant renewal and a drive for progress.",
                secondary_influence_vibe: "You radiate a resilient and fresh quality, always looking towards growth and new possibilities."
            },
            "Fire": {
                core_personality: "You are known for being **passionate**, **enthusiastic**, **charismatic**, and **inspiring**.",
                core_energy: "Your energy is **intense** and **transformative**, bringing warmth and excitement, and igniting action in others.",
                core_vibe: "You project a **radiant**, **energetic**, and **captivating** aura.",
                lifestyle: "You are drawn to vibrant social gatherings, performing arts, and adventurous travel. Express yourself through engaging hobbies and enjoy being at the center of stimulating experiences.",
                balance: "To maintain harmony, cultivate inner calm and moderation. Your fiery nature can lead to overstimulation; practice mindfulness, meditation, or gentle exercise to cool down. Avoid excessive stimulants and ensure enough time for quiet reflection to prevent impulsiveness and maintain your inner spark.",
                secondary_influence_personality: "This infuses your personality with an extra spark of enthusiasm and a compelling desire to inspire.",
                secondary_influence_energy: "Your energy is further amplified by a warm, infectious enthusiasm that effortlessly ignites others.",
                secondary_influence_vibe: "You also project an undeniable glow of warmth and inspiration, drawing people towards you."
            },
            "Earth": {
                core_personality: "You are known for being **stable**, **grounded**, **nurturing**, and **practical**.",
                core_energy: "Your energy is **steady** and **harmonizing**, promoting stability, security, and consistent support.",
                core_vibe: "You exude a **comforting**, **reliable**, and **solid** aura.",
                lifestyle: "You find joy in creating a nurturing home environment, engaging in practical skills, and community service. Comforting routines and wholesome meals bring you deep contentment and security.",
                balance: "To maintain harmony, encourage adaptability and open-mindedness. While stability is your strength, be open to new experiences and stepping out of your comfort zone. Manage worry and overthinking by staying present, focusing on what you can control, and engaging in grounding activities like gardening or connecting with nature.",
                secondary_influence_personality: "This provides a steady, nurturing foundation to your core traits, making you exceptionally dependable and supportive.",
                secondary_influence_energy: "Your energy gains an extra layer of stability and a supportive, harmonizing presence that puts others at ease.",
                secondary_influence_vibe: "You also radiate a deeply comforting and trustworthy aura, making others feel secure in your presence."
            },
            "Metal": {
                core_personality: "You are known for being **organized**, **disciplined**, **precise**, and **discerning**.",
                core_energy: "Your energy is **refined** and **structured**, emphasizing clarity and order, and leading to efficient results.",
                core_vibe: "You project a **crisp**, **clear**, and **focused** aura.",
                lifestyle: "You appreciate beauty in simplicity, logical thinking, and activities that require precision. Minimalist living, intellectual pursuits, and structured routines appeal greatly to you. You thrive in clean, orderly environments.",
                balance: "To maintain harmony, foster emotional expression and spontaneity. While structure is important, allow room for intuition and feeling. Connect with others authentically and release rigidity. Embrace change as a natural part of growth and let go of the need for absolute control.",
                secondary_influence_personality: "This lends a sharp clarity and a touch of refined elegance to your character, enhancing your meticulousness.",
                secondary_influence_energy: "Your energy also carries a precise, results-driven focus and a desire for purity and excellence.",
                secondary_influence_vibe: "You project a clear, discerning, and often sophisticated presence, with an air of dignified resolve."
            },
            "Water": {
                core_personality: "You are known for being **intuitive**, **adaptable**, **reflective**, and **empathetic**.",
                core_energy: "Your energy is **flowing** and **deep**, representing wisdom and introspection, allowing you to adapt with grace.",
                core_vibe: "You exude a **calm**, **mysterious**, and **profound** aura.",
                lifestyle: "You thrive in environments that allow for contemplation, emotional depth, and connection to your inner world. Solitary reflection, creative writing, spiritual practices, and fluid movements like yoga or swimming are highly beneficial.",
                balance: "To maintain harmony, develop clear boundaries and self-assertion. While empathetic, ensure you don't absorb too much from others. Engage in activities that build confidence and help you express your needs. Avoid isolation and stagnation by connecting with supportive communities and channeling your wisdom outwards.",
                secondary_influence_personality: "This adds a layer of deep intuition and profound empathy to your interactions, making you highly understanding.",
                secondary_influence_energy: "Your energy possesses a subtle, adaptable flow and an insightful depth that allows you to see beyond the surface.",
                secondary_influence_vibe: "You also radiate a serene, thoughtful, and deeply understanding aura, drawing people into meaningful connection."
            }
        };

        // Function to draw the Chart.js pie chart
        function drawChart(percentages) {
            const ctx = document.getElementById('elementalChart').getContext('2d');
            const labels = Object.keys(percentages);
            const data = Object.values(percentages).map(Number); // Convert to numbers for Chart.js

            const backgroundColors = labels.map(label => {
                switch (label) {
                    case 'Wood': return 'rgb(46, 139, 87)'; // Sea Green
                    case 'Fire': return 'rgb(228, 77, 38)';  // Cinnabar
                    case 'Earth': return 'rgb(160, 82, 45)'; // Sienna
                    case 'Metal': return 'rgb(169, 169, 169)';// Dark Gray
                    case 'Water': return 'rgb(43, 108, 176)'; // Strong Blue
                    default: return '#cccccc';
                }
            });

            if (elementalChartInstance) {
                elementalChartInstance.destroy(); // Destroy existing chart if it exists
            }

            elementalChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        hoverOffset: 10,
                        borderWidth: 1,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    family: 'Open Sans',
                                    size: 14
                                },
                                color: '#333'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.getElementById('elementalForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const userName = document.getElementById('userName').value;
            const birthDateStr = document.getElementById('birthDate').value;
            const birthTimeStr = document.getElementById('birthTime').value;

            if (!userName || !birthDateStr || !birthTimeStr) {
                alert('Please fill in all fields to generate your Elemental Energy Insight.');
                return;
            }

            const birthDate = new Date(birthDateStr);
            const birthTime = new Date(`2000-01-01T${birthTimeStr}`); // Dummy date for time extraction

            if (isNaN(birthDate.getTime()) || isNaN(birthTime.getTime())) {
                alert('Please enter a valid Date and Time of Birth.');
                return;
            }

            // Show loading overlay
            document.getElementById('loadingOverlay').style.display = 'flex';

            // Simulate loading for better UX
            setTimeout(() => {
                const elementalPercentages = calculateElementalProportions(birthDate, birthTime);

                // Determine the dominant and secondary elements by percentage
                let sortedElements = Object.keys(elementalPercentages).sort((a, b) => parseFloat(elementalPercentages[b]) - parseFloat(elementalPercentages[a]));
                const dominantElement = sortedElements[0];
                let secondaryElement = sortedElements.length > 1 ? sortedElements[1] : dominantElement;
                if (dominantElement === secondaryElement && sortedElements.length > 2) {
                    secondaryElement = sortedElements[2]; // Get third if dominant and secondary are the same
                } else if (dominantElement === secondaryElement && sortedElements.length === 1) {
                    secondaryElement = dominantElement; // If only one element (unlikely but safe)
                }

                // Get descriptions for dominant and secondary elements
                const dominantDesc = descriptions[dominantElement];
                const secondaryDesc = descriptions[secondaryElement];

                // --- Display Results ---
                document.getElementById('displayedUserName').textContent = userName;
                document.getElementById('dominantElementOutput').textContent = `${dominantElement} (${elementalPercentages[dominantElement]}%)`;

                // Display all elemental percentages
                const percentagesOutputDiv = document.getElementById('elementPercentagesOutput');
                percentagesOutputDiv.innerHTML = ''; // Clear previous results
                const orderedElements = ["Wood", "Fire", "Earth", "Metal", "Water"]; // Consistent display order
                orderedElements.forEach(el => {
                    const percent = elementalPercentages[el] || "0.0";
                    const div = document.createElement('div');
                    div.className = `element-percent-item ${el.toLowerCase()}`;
                    div.innerHTML = `<strong>${el}:</strong> ${percent}%`;
                    percentagesOutputDiv.appendChild(div);
                });

                // Draw the Chart.js pie chart
                drawChart(elementalPercentages);


                // Combine descriptions for Personality, Energy, Vibe
                // Ensure secondary influence is only added if there's a distinct secondary element
                document.getElementById('personalityType').textContent =
                    `${dominantDesc.core_personality} ${secondaryElement !== dominantElement ? secondaryDesc.secondary_influence_personality : ''}`;

                document.getElementById('energyStyle').textContent =
                    `${dominantDesc.core_energy} ${secondaryElement !== dominantElement ? secondaryDesc.secondary_influence_energy : ''}`;

                document.getElementById('elementalVibe').textContent =
                    `${dominantDesc.core_vibe} ${secondaryElement !== dominantElement ? secondaryDesc.secondary_influence_vibe : ''}`;

                document.getElementById('lifestyleAffinity').textContent = dominantDesc.lifestyle;
                document.getElementById('balanceSuggestions').textContent = dominantDesc.balance;

                // Update CTA links based on Dominant Element
                const collectionMap = {
                    "Wood": "/collections/wood-collection",
                    "Fire": "/collections/fire-collection",
                    "Earth": "/collections/earth-collection",
                    "Metal": "/collections/metal-collection",
                    "Water": "/collections/water-collection"
                };
                document.getElementById('exploreCollectionBtn').href = collectionMap[dominantElement] || '#';

                // --- Social Sharing ---
                const currentPageURL = encodeURIComponent(window.location.href);
                document.querySelector('.share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${currentPageURL}`;
                document.querySelector('.share-twitter').href = `https://twitter.com/intent/tweet?url=${currentPageURL}&text=Explore your elemental insights!`;
                document.querySelector('.share-whatsapp').href = `https://api.whatsapp.com/send?text=${currentPageURL}`;
                document.querySelector('.share-copy').onclick = () => {
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        alert('Link copied to clipboard!');
                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                    });
                };

                // --- Download Report Functionality ---
                document.getElementById('downloadReportBtn').onclick = () => {
                    const originalResultsHtml = document.getElementById('results').outerHTML;
                    const originalBodyContent = document.body.outerHTML; // Get full body content
                    const tempDoc = document.implementation.createHTMLDocument();
                    tempDoc.documentElement.innerHTML = originalBodyContent;

                    // Remove interactive elements, form, and script tags from the download version
                    const formToRemove = tempDoc.getElementById('elementalForm');
                    if (formToRemove) formToRemove.remove();
                    const loadingOverlayToRemove = tempDoc.getElementById('loadingOverlay');
                    if (loadingOverlayToRemove) loadingOverlayToRemove.remove();
                    const scriptToRemove = tempDoc.querySelector('script'); // Removes the main script
                    if (scriptToRemove) scriptToRemove.remove();
                    const chartJsScriptToRemove = tempDoc.querySelector('script[src*="chart.js"]'); // Remove Chart.js script
                    if (chartJsScriptToRemove) chartJsScriptToRemove.remove();


                    // Get the Chart.js image data URL
                    const chartCanvas = document.getElementById('elementalChart');
                    let chartImageUrl = '';
                    if (chartCanvas) {
                        chartImageUrl = chartCanvas.toDataURL('image/png');
                        // Replace canvas with image in the temporary document
                        const img = tempDoc.createElement('img');
                        img.src = chartImageUrl;
                        img.style.maxWidth = '100%';
                        img.style.height = 'auto';
                        img.style.display = 'block';
                        img.style.margin = 'auto';
                        const chartContainerInTemp = tempDoc.querySelector('.chart-container');
                        if (chartContainerInTemp) {
                            chartContainerInTemp.innerHTML = ''; // Clear canvas
                            chartContainerInTemp.appendChild(img);
                        }
                    }

                    // Remove CTA buttons specific to Shopline actions in the download version
                    const shoplineButtons = tempDoc.querySelectorAll('#exploreCollectionBtn, #getFullReportBtn');
                    shoplineButtons.forEach(btn => btn.remove());
                    const ctaNoteToRemove = tempDoc.querySelector('.cta-note');
                    if (ctaNoteToRemove) ctaNoteToRemove.remove();

                    // Adjust social share buttons for download (remove links, keep text)
                    const socialButtonsInTemp = tempDoc.querySelectorAll('.social-share-buttons a, .social-share-buttons button');
                    socialButtonsInTemp.forEach(btn => {
                        btn.removeAttribute('href');
                        btn.style.backgroundColor = '#ccc'; // Grey out
                        btn.style.color = '#666';
                        btn.style.pointerEvents = 'none'; // Make non-clickable
                    });
                    const socialShareSection = tempDoc.querySelector('.social-share-buttons');
                    if (socialShareSection) {
                        const disclaimer = tempDoc.createElement('p');
                        disclaimer.style.textAlign = 'center';
                        disclaimer.style.marginTop = '15px';
                        disclaimer.style.fontSize = '0.9em';
                        disclaimer.style.color = '#888';
                        disclaimer.textContent = 'Share options are available on the live web page.';
                        socialShareSection.parentNode.insertBefore(disclaimer, socialShareSection.nextSibling);
                    }
                    if (socialShareSection) socialShareSection.remove(); // Remove entire social share section

                    // Remove the download button itself from the downloadable HTML
                    const downloadBtnInTemp = tempDoc.getElementById('downloadReportBtn');
                    if (downloadBtnInTemp) downloadBtnInTemp.remove();

                    // Hide the initial container content, only show #results
                    const formSectionInTemp = tempDoc.querySelector('h1, p'); // Select header elements
                    if (formSectionInTemp) formSectionInTemp.remove(); // Remove initial intro text
                    if (tempDoc.querySelector('form')) tempDoc.querySelector('form').remove(); // Remove form

                    // Get the outer HTML of the modified body
                    let downloadHtmlContent = `<!DOCTYPE html>${tempDoc.documentElement.outerHTML}`;

                    const fileName = `Five_Element_Report_${userName.replace(/\s+/g, '_')}.html`;
                    const blob = new Blob([downloadHtmlContent], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                };

                // Hide loading overlay and show results
                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('results').style.display = 'block';

                // Scroll to results for better UX on mobile
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

            }, 1000); // Simulate 1 second loading time
        });
    </script>
</body>
</html>
